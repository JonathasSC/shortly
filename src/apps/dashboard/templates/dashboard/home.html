{% include 'common/manage.html' %}
{% load static %}

{% load i18n %}


{% block extrahead %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock extrahead %}

{% block header %}
{% endblock header %}

{% block content %}
<main class="w-full mt-16 flex items-center justify-center">
    <div class="p-6 w-full max-w-[1440px] space-y-6">
        <div class="flex flex-col">
            <h1 class="font-bold text-xl">Painel Administrativo</h1>
            <p class="text-zinc-400">Visualize e gerencie todos os seus links encurtados</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-white border flex gap-2 flex-col border-zinc-200 rounded p-4">
                <h2 class="text-lg font-bold flex items-center gap-2">
                    <div class="flex items-center justify-center p-1 bg-zinc-50 rounded-full">
                        <span class="material-symbols-outlined">
                            link
                        </span>

                    </div>
                    Meus Links
                </h2>
                <p class="text-3xl font-extrabold">{{ total_links }}</p>
                <p>Links encurtados por vocÃª</p>
            </div>
            <div class="bg-white border flex gap-2 flex-col border-zinc-200 rounded p-4">
                <h2 class="text-lg font-bold flex items-center gap-2">
                    <div class="flex items-center justify-center p-1 bg-zinc-50 rounded-full">
                        <span class="material-symbols-outlined">
                            ads_click
                        </span>

                    </div>
                    Total de Acessos
                </h2>
                <p class="text-3xl font-extrabold">{{ total_accesses }}</p>
                <p>Total de acessos de todos os seus links</p>
            </div>
            <div class="bg-white border flex gap-2 flex-col border-zinc-200 rounded p-4">
                <h2 class="text-lg font-bold flex items-center gap-2">
                    <div class="flex items-center justify-center p-1 bg-zinc-50 rounded-full">
                        <span class="material-symbols-outlined">
                            link
                        </span>

                    </div>
                    Links Ativos
                </h2>
                <p class="text-3xl font-extrabold">{{ user_links|length }}</p>
                <p>Seus links encurtados e ativos</p>
            </div>
        </div>
    
        <div class="bg-white border border-zinc-200 rounded p-4">
            <h2 class="text-lg font-bold mb-4">Meus Links Recentes</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full table-auto border-collapse">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border px-2 py-1 text-left">ID</th>
                            <th class="border px-2 py-1 text-left">URL Original</th>
                            <th class="border px-2 py-1 text-left">Short Link</th>
                            <th class="border px-2 py-1 text-left">Cliques</th>
                            <th class="border px-2 py-1 text-left">Criado em</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for link in recent_links %}
                        <tr class="hover:bg-gray-50">
                            <td class="border px-2 py-1">{{ forloop.counter }}</td>
                            <td class="border px-2 py-1 truncate max-w-xs">{{ link.original_url }}</td>
                            <td class="border px-2 py-1 text-blue-600">
                                <a href="{{ request.scheme }}://{{ request.get_host }}/{{ link.short_code }}" target="_blank">
                                    {{ link.short_code }}
                                </a>
                            </td>
                            <td class="border px-2 py-1">{{ link.clicks|default:0 }}</td>
                            <td class="border px-2 py-1">{{ link.created_at|date:"d/m/Y H:i" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="border px-2 py-1 text-center text-gray-500">
                                Nenhum link registrado
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="flex w-full gap-2 justify-beetween">
            {% include 'dashboard/includes/analytics.html' %}
            {% include 'dashboard/includes/devices.html' %}
        </div>
    </div>
</main>
{% endblock %}

{% block scripts %}
<script src="{% static 'dashboard/home_analytics.js'%}"></script>

{{ line_labels|json_script:"lineLabels" }}
{{ line_data|json_script:"lineData" }}
{{ pie_labels|json_script:"pieLabels" }}
{{ pie_data|json_script:"pieData" }}

{% endblock scripts %}
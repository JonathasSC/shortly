{% load static %}
{% load i18n %}
{% load toggler_tags %}

<header id="main-header" class="fixed w-full z-50 border-zinc-100 bg-transparent transition-all duration-300 ease-in-out">
  <div class="border-box px-4 py-3 flex items-center justify-between">
    <a href="{% url 'home' %}" class="text-2xl font-bold text-gray-800">
      <img class='w-36' src="{% static '/common/svg/logo/without_bg_with_text_blue.svg' %}" alt='logo do shortly'>
    </a>

    <div class="flex items-center gap-3">
      <div class="hidden sm:flex items-center gap-3">
        <div class="relative group">
          <div class="cursor-pointer flex items-center gap-1 sm:gap-2 px-3 py-2 
                      border border-zinc-200 rounded-md bg-white hover:bg-zinc-100
                      transition-all duration-200 select-none shadow-sm">

            <span class="material-symbols-outlined text-zinc-600 text-base">translate</span>
            <span class="text-sm hidden sm:block font-medium text-zinc-700">
              {% if request.LANGUAGE_CODE == "pt-br" %} PT {% else %} EN {% endif %}
            </span>
            <span class="material-symbols-outlined text-zinc-500 text-sm">expand_more</span>
          </div>

          <div class="absolute right-0 mt-2 w-32 bg-white border border-zinc-200 rounded-md shadow-lg 
                      opacity-0 invisible group-hover:opacity-100 group-hover:visible 
                      transition-all duration-200 overflow-hidden">
            <form method="post" action="{% url 'set_language' %}" class="flex flex-col">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}">
              <button type="submit" name="language" value="pt-br"
                      class="px-3 py-2 text-sm flex items-center gap-2 hover:bg-zinc-100
                            {% if request.LANGUAGE_CODE == 'pt-br' %} bg-blue-50 text-blue-600 font-semibold {% endif %}">
                ðŸ‡§ðŸ‡· PortuguÃªs
              </button>
              <button type="submit" name="language" value="en"
                      class="px-3 py-2 text-sm flex items-center gap-2 hover:bg-zinc-100
                            {% if request.LANGUAGE_CODE == 'en' %} bg-blue-50 text-blue-600 font-semibold {% endif %}">
                ðŸ‡ºðŸ‡¸ English
              </button>
            </form>
          </div>
        </div>

        {% if not user.is_authenticated %}
          <a href="{% url 'login' %}" class="flex items-center gap-2 px-4 py-2 font-medium text-blue-700 
                                            bg-blue-100 rounded-md hover:bg-blue-200 transition duration-200 shadow-sm">
            <span class="material-symbols-outlined">login</span>
            <span class="hidden sm:block">{% trans "Login" %}</span>
          </a>

          <a href="{% url 'register' %}" class="flex items-center gap-2 px-4 py-2 font-medium text-white 
                                              bg-blue-500 rounded-md hover:bg-blue-600 transition duration-200 shadow-sm">
            <span class="material-symbols-outlined">person_add</span>
            <span class="hidden sm:block">{% trans "Create Account" %}</span>
          </a>
        {% else %}
          <a href="{% url 'wallet_page' %}" 
            class="bg-blue-100 rounded-full text-blue-500 text-base font-bold flex items-center gap-2 px-3 py-2 shadow-sm">
            <span class="text-white bg-blue-500 rounded-full w-6 h-6 flex items-center justify-center">
              C
            </span>
            {{ user_balance }}
          </a>

          <div class="relative group">
            <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center 
                        cursor-pointer select-none shadow-sm">
              {{ user.first_name|default:user.username|first|upper }}
            </div>

            <div class="absolute right-0 mt-2 w-48 bg-white shadow-lg border border-zinc-200 rounded-lg 
                        opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">

              <a href="{% url 'dashboard-home' %}" class="flex items-center gap-2 px-4 py-2 text-sm hover:bg-zinc-100">
                <span class="material-symbols-outlined text-blue-500">dashboard</span>
                {% trans "Dashboard" %}
              </a>

              {% if user|feature_enabled:"profile_unavailable" %}
                <a href="{% url 'dashboard-home' %}" class="flex items-center gap-2 px-4 py-2 text-sm hover:bg-zinc-100">
                  <span class="material-symbols-outlined text-blue-500">person</span>
                  {% trans "My Account" %}
                </a>
              {% endif %}

              <div class="border-t border-zinc-200"></div>

              <form action="{% url 'logout' %}" method="post">
                {% csrf_token %}
                <button type="submit" class="flex items-center gap-2 w-full text-left px-4 py-2 text-sm hover:bg-zinc-100 text-red-500">
                  <span class="material-symbols-outlined">logout</span>
                  {% trans "Logout" %}
                </button>
              </form>
            </div>
          </div>
        {% endif %}
      </div>

      <div class="sm:hidden relative">

        <div class="flex gap-2">
          {% if user.is_authenticated %}
          <div class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center 
                      select-none shadow-sm text-lg">
            {{ user.first_name|default:user.username|first|upper }}
          </div>
          {% endif %}
  
          <button id="mobile-menu-button" class="flex items-center p-2 border rounded-md border-zinc-200 shadow-sm hover:bg-zinc-100">
            <span class="material-symbols-outlined">menu</span>
          </button>

        </div>

        <div id="mobile-menu" class="absolute right-0 mt-2 w-64 bg-white border border-zinc-200 rounded-md shadow-lg
                                    opacity-0 invisible transition-all duration-200 overflow-hidden">
          <form method="post" action="{% url 'set_language' %}" class="flex flex-col p-2">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.get_full_path }}">
            <button type="submit" name="language" value="pt-br"
                    class="px-3 py-2 text-sm flex items-center gap-2 hover:bg-zinc-100
                          {% if request.LANGUAGE_CODE == 'pt-br' %} bg-blue-50 text-blue-600 font-semibold {% endif %}">
              ðŸ‡§ðŸ‡· PortuguÃªs
            </button>
            <button type="submit" name="language" value="en"
                    class="px-3 py-2 text-sm flex items-center gap-2 hover:bg-zinc-100
                          {% if request.LANGUAGE_CODE == 'en' %} bg-blue-50 text-blue-600 font-semibold {% endif %}">
              ðŸ‡ºðŸ‡¸ English
            </button>
          </form>

          <div class="border-t border-zinc-200"></div>

          {% if not user.is_authenticated %}
            <a href="{% url 'login' %}" class="block px-4 py-2 text-sm hover:bg-zinc-100">{% trans "Login" %}</a>
            <a href="{% url 'register' %}" class="block px-4 py-2 text-sm hover:bg-zinc-100">{% trans "Create Account" %}</a>
          {% else %}
            <a href="{% url 'dashboard-home' %}" class="block px-4 py-2 text-sm hover:bg-zinc-100">{% trans "Dashboard" %}</a>
              {% if user|feature_enabled:"profile_unavailable" %}
              <a href="{% url 'dashboard-home' %}" class="block px-4 py-2 text-sm hover:bg-zinc-100">{% trans "My Account" %}</a>
            {% endif %}
            <form action="{% url 'logout' %}" method="post">
              {% csrf_token %}
              <button type="submit" class="w-full text-left px-4 py-2 text-sm hover:bg-zinc-100 text-red-500">
                {% trans "Logout" %}
              </button>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');

  button.addEventListener('click', () => {
    menu.classList.toggle('opacity-0');
    menu.classList.toggle('invisible');
    menu.classList.toggle('opacity-100');
    menu.classList.toggle('visible');
  });
</script>